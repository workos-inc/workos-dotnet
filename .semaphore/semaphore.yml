version: v1.0
name: workos-dotnet

agent:
  machine:
    type: e1-standard-2
    os_image: ubuntu1804

blocks:
  - name: Install netcoreapp3.1 and Build Project
    dependencies: []
    task:
      jobs:
        - name: Install dependencies
          commands:
            - checkout
            - wget https://packages.microsoft.com/config/ubuntu/18.04/packages-microsoft-prod.deb -O packages-microsoft-prod.deb
            - sudo dpkg -i packages-microsoft-prod.deb
            - sudo apt-get install -y apt-transport-https
            - sudo apt-get update
            - sudo apt-get install -y dotnet-sdk-3.1
            - dotnet build src/WorkOS.net/WorkOS.net.csproj -c Debug
            - dotnet build test/WorkOSTests/WorkOSTests.csproj -c Debug
            - dotnet test test/WorkOSTests/WorkOSTests.csproj -c Debug -f netcoreapp3.1
